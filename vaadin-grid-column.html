<link rel="import" href="../polymer/polymer.html">

<dom-module id="vaadin-grid-column">
  <script>
    Polymer({
      is: 'vaadin-grid-column',

      properties: {
        instances: {
          type: Array,
          value: function() {
            return [];
          }
        },
        name: {
          type: String,
          value: ''
        },
        footerTemplate: {
          type: Object,
          notify: true,
          value: function() {
            return this._findTemplate('footer');
          }
        },
        headerTemplate: {
          type: Object,
          notify: true,
          value: function() {
            return this._findTemplate('header');
          }
        },
        template: {
          type: Object,
          notify: true,
          value: function() {
            return this._findTemplate(null);
          }
        },
        width: {
          type: String,
          value: '100px'
        },

        flex: {
          type: Number,
          value: 1
        }
      },

      observers: ['_flexChanged(flex)',
                  '_footerTemplateChanged(footerTemplate)',
                  '_widthChanged(width)',
                  '_templateChanged(template)',
                  '_headerTemplateChanged(headerTemplate)'],

      _findTemplate: function(type) {
        var template = Polymer.dom(this).children.filter(function(el) {
          return el.localName === 'template' && el.getAttribute('is') === type;
        })[0];
        if(template) {
          if(this.dataHost) {
            // set dataHost to the context where template has been defined
            template._rootDataHost = this.dataHost._rootDataHost || this.dataHost;
          }

          return template;
        }
      },

      _flexChanged: function(flex) {
        this.fire('column-changed', {path: 'flex', value: flex});
      },

      _footerTemplateChanged: function(template) {
        this.fire('column-changed', {path: 'footerTemplate', value: template});
      },

      _headerTemplateChanged: function(template) {
        this.fire('column-changed', {path: 'headerTemplate', value: template});
      },

      _templateChanged: function(template) {
        this.fire('column-changed', {path: 'template', value: template});
      },

      _widthChanged: function(width) {
        this.fire('column-changed', {path: 'width', value: width});
      }
    });
  </script>
</dom-module>
