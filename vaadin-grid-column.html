<link rel="import" href="../polymer/polymer.html">

<dom-module id="vaadin-grid-column">
  <script>
    Polymer({
      is: 'vaadin-grid-column',

      properties: {
        instances: {
          type: Array,
          value: function() {
            return [];
          }
        },
        name: {
          type: String,
          value: ''
        },
        headerTemplate: {
          type: Object,
          notify: true,
          value: function() {
            var template = Polymer.dom(this).querySelector('template[is=header]');
            if (this.dataHost) {
              // set dataHost to the context where template has been defined
              template._rootDataHost = this.dataHost._rootDataHost || this.dataHost;
            }
            return template;
          }
        },
        template: {
          type: Object,
          notify: true,
          value: function() {
            var template = Polymer.dom(this).querySelector('template:not([is=header])');
            if (this.dataHost) {
              // set dataHost to the context where template has been defined
              template._rootDataHost = this.dataHost._rootDataHost || this.dataHost;
            }
            return template;
          }
        },
        width: {
          type: String,
          value: '100px'
        },

        flex: {
          type: Number,
          value: 1
        },

        /**
         * Reference to the parent <vaadin-grid> element
         */
        grid: Object
      },

      observers: ['_flexChanged(grid, flex)',
                  '_widthChanged(grid, width)',
                  '_templateChanged(grid, template)',
                  '_headerTemplateChanged(grid, headerTemplate)'],

      _notifyGrid: function(grid, prop, value) {
        var index = grid.columns.indexOf(this);
        grid.notifyPath('columns.' + index + '.' + prop, value);
      },

      _notifyGroups: function(grid, prop, value) {
        grid._columnGroups.forEach(function(group) {
          var index = group.columns && group.columns.indexOf(this);
          group.notifyPath('columns.' + index + '.' + prop, value);
        }.bind(this));
      },

      _flexChanged: function(grid, flex) {
        this._notifyGrid(grid, 'flex', flex);
        this._notifyGroups(grid, 'flex', flex);
      },

      _headerTemplateChanged: function(grid, template) {
        this._notifyGrid(grid, 'headerTemplate', template);
      },

      _templateChanged: function(grid, template) {
        this._notifyGrid(grid, 'template', template);
      },

      _widthChanged: function(grid, width) {
        this._notifyGrid(grid, 'width', width);
        this._notifyGroups(grid, 'width', width);
      }
    });
  </script>
</dom-module>
