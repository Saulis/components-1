<link rel="import" href="../paper-checkbox/paper-checkbox.html">

<dom-module id="vaadin-grid-sorter">
  <template>
    <style>
      :host {
        display: inline-flex;
        cursor: pointer;
      }

      #indicator[direction=asc] {
        transform: rotateZ(180deg);
      }
    </style>

    <content></content>
    <content select=".sort-indicator">
      <div id="indicator" direction$="[[sort.direction]]">^</div>
    </content>
  </template>
  <script>
    Polymer({
      is: 'vaadin-grid-sorter',

      attached: function () {
        this.listen(this._getCell(this.parentNode), 'cell-click', '_onTap');
      },

      properties: {

        sortOrder: {
          type: Array,
          notify: true
        },

        path: String,

        sort: Object
      },

      _onTap: function() {
        var grid = this._getGrid(this.parentNode);
        grid._sortOrder = grid._sortOrder || [];

        var sort = grid._sortOrder.filter(function(sort) {
          return sort.path === this.path;
        }, this)[0];

        sort = sort || {
          path: this.path,
          direction: 'desc'
        };

        if (sort.direction === 'desc') {
          sort.direction = 'asc';
        } else if (sort.direction === 'asc') {
          sort.direction = 'desc';
        }

        grid._sortOrder.splice(grid._sortOrder.indexOf(sort), 1);

        this.notifyPath('sort', sort);
        this.notifyPath('sort.direction', sort.direction);

        grid.push('_sortOrder', sort);
      },

      _getGrid: function(node) {
        if (node.is == 'vaadin-grid') {
          return node;
        }
        return this._getGrid(node.parentNode);
      },

      _getCell: function(node) {
        if (node.tagName == 'TD' || node.tagName == 'TH') {
          return node;
        }
        return this._getCell(node.parentNode);
      }
    });
  </script>
</dom-module>

<script>
  window.vaadin = window.vaadin || {};
  vaadin.elements = vaadin.elements || {};
  vaadin.elements.grid = vaadin.elements.grid || {};

  vaadin.elements.grid.SortBehavior = {

    properties: {
      _sortOrder: Array
    },

    observers: [
      'clearCache(_sortOrder, _sortOrder.*)'
    ]

  };
</script>
