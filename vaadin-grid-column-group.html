<dom-module id="vaadin-grid-column-group">
  <script>
    Polymer({
      is: 'vaadin-grid-column-group',

      properties: {
        columns: {
          value: function() {
            return Polymer.dom(this).querySelectorAll('vaadin-grid-column');
          }
        },
        flex: Number,
        grid: Object,
        headerTemplate: {
          type: Object,
          value: function() {
            var t = Polymer.dom(this).querySelector('template[is=header]');

            if(t && this.dataHost) {
              // set dataHost to the context where template has been defined
              t._rootDataHost = this.dataHost._rootDataHost || this.dataHost;
            }

            return t;
          }
        },

        width: String
      },

      observers: ['_columnsChanged(grid, columns.*)',
                  '_flexChanged(grid, flex)',
                  '_headerTemplateChanged(grid, headerTemplate)',
                  '_widthChanged(grid, width)'],

      _notifyGrid: function(grid, prop, value) {
        var index = grid._columnGroups.indexOf(this);
        grid.notifyPath('_columnGroups.' + index + '.' + prop, value);
      },

      _headerTemplateChanged: function(grid, template) {
        this._notifyGrid(grid, 'headerTemplate', template);
      },

      _columnsChanged: function(grid, e) {
        if (e.path === 'columns' || e.path.indexOf('columns.#') === 0) {
          var width = '';
          var flex = 0;

          this.columns.forEach(function(col) {
            width += ' + ' + col.width || '100px'; // TODO: columns doesn't have width before upgrade.
            flex +=  col.flex || 1; // TODO: column doesn't have flex value before upgrade.
          });

          this.width = width.substring(3);
          this.flex = flex;
        }
      },

      _flexChanged: function(grid, flex) {
        this._notifyGrid(grid, 'flex', flex);
      },

      _widthChanged: function(grid, width) {
        this._notifyGrid(grid, 'width', width);
      }
    });
  </script>
</dom-module>
